<!DOCTYPE html>
<html lang="es">
<head>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GamerVault | Iniciar Sesi칩n</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="css/style.css">

  <style>
    body { min-height: 100vh; display: flex; flex-direction: column; }
    .login-section { flex: 1; display: flex; justify-content: center; align-items: center; padding: 40px 20px; background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%); }
    .login-card { background: rgba(20, 20, 20, 0.9); padding: 40px; border-radius: 15px; border: 1px solid #333; box-shadow: 0 0 20px rgba(178, 107, 255, 0.2); width: 100%; max-width: 400px; text-align: center; position: relative; z-index: 10; }
    .login-card h2 { font-family: 'Orbitron', sans-serif; color: #fff; margin-bottom: 20px; font-size: 1.8rem; }
    .form-group { margin-bottom: 15px; text-align: left; }
    .form-group label { display: block; color: #ccc; margin-bottom: 5px; font-size: 0.9rem; }
    .form-group input { width: 100%; padding: 12px; background: #111; border: 1px solid #444; border-radius: 6px; color: white; outline: none; transition: 0.3s; }
    .form-group input:focus { border-color: #b26bff; box-shadow: 0 0 8px rgba(178, 107, 255, 0.4); }
    .btn-submit { width: 100%; padding: 12px; background: #b26bff; border: none; color: white; font-weight: bold; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-top: 10px; transition: 0.3s; }
    .btn-submit:hover { background: #9040ff; }
    .divider { margin: 20px 0; border-top: 1px solid #333; position: relative; }
    .divider span { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: #141414; padding: 0 10px; color: #666; font-size: 0.8rem; }
    .btn-google { width: 100%; padding: 12px; background: white; color: #333; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }
    .btn-google:hover { background: #f1f1f1; }
  </style>
</head>
<body>

  <header class="navbar"></header>

<section class="login-section">
   <div class="login-card">
     <h2>游 Iniciar Sesi칩n</h2>
     <form id="auth-form">
              <button type="submit" class="btn-submit" id="submitBtn">Entrar / Registrarse</button>
     </form>

     <div class="divider"><span>O contin칰a con</span></div>

     <button id="google-login-btn" class="btn-google">
       <i class="fab fa-google"></i> Google
     </button>
   </div>
 </section>

 <footer><p>춸 2025 GamerVault</p></footer>

 <script type="module" src="js/navbar.js"></script>
 <script type="module" src="js/chatbot.js"></script>
 
  <script type="module">
   import { supabase } from './js/supabaseClient.js'; // Asumimos esta ruta es correcta

   const form = document.getElementById('auth-form');
   const btn = document.getElementById('submitBtn');

      // CR칈TICO: Definir la URL de redirecci칩n para GitHub Pages
      // Asume que el repositorio es /GamerVault/
      const repoBase = window.location.origin + '/GamerVault';
      const redirectUrl = repoBase + '/index.html'; 

   form.addEventListener('submit', async (e) => {
     e.preventDefault();
     const email = document.getElementById('email').value;
     const password = document.getElementById('password').value;
    먝
     btn.innerText = "Procesando..."; btn.disabled = true;

     // Intento de Login
     let { error } = await supabase.auth.signInWithPassword({ email, password });
    먝
     if (error) {
       // Si falla, intentamos Registro
       const { error: signUpError } = await supabase.auth.signUp({ email, password });
       if (signUpError) {
         Swal.fire('Error', 'Credenciales inv치lidas o error en registro.', 'error');
         btn.innerText = "Entrar / Registrarse"; btn.disabled = false;
       } else {
         Swal.fire('Bienvenido', 'Registro exitoso. 춰Revisa tu correo!', 'success');
                  // Nota: En un registro exitoso, el usuario debe ir a verificar el correo, 
                  // NO debe redirigir inmediatamente, por eso no agregamos el window.location.href aqu칤.
       }
     } else {
       // Login Exitoso
       window.location.href = repoBase + '/perfil.html'; // Usamos repoBase para perfil.html
     }
           btn.innerText = "Entrar / Registrarse"; btn.disabled = false;
   });

   document.getElementById('google-login-btn').addEventListener('click', async () => {
     await supabase.auth.signInWithOAuth({ 
              provider: 'google', 
              options: { 
                  // CR칈TICO: Usamos la URL completa de GitHub Pages para el redirect
                  redirectTo: redirectUrl 
              }
          });
   });
 </script>

</body>
</html>
